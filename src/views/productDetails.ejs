<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.sm_name %> - Details</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <% locals.currentPage = 'products' %>
    <%- include('partials/header') %>

    <div class="container">
        <div class="product-details-card">
            <h1 class="text-center"><%= product.sm_name %></h1>
            <div class="product-details-link">
                <button onclick="window.location.href='/products'" class="back-button">‚Üê Back to Products</button>
            </div>
            
            <% if(typeof variants !== 'undefined' && Array.isArray(variants) && variants.length > 0) { %>
                <div class="variant-summary">
                    <span class="variant-count"><%= variants.length %> variants available for <%= modelName || product.sm_name %></span>
                </div>
                
                <div class="all-variants-section">
                    <h2>All Available Variants</h2>
                    
                    <div id="allVariantsTable" class="variants-table-container">
                        <h3>Compare All <%= variants.length %> Variants</h3>
                        <div class="table-controls">
                            <select id="sortVariants">
                                <option value="color">Sort by Color</option>
                                <option value="price-low">Sort by Price (Low to High)</option>
                                <option value="price-high">Sort by Price (High to Low)</option>
                                <option value="ram">Sort by RAM</option>
                                <option value="storage">Sort by Storage</option>
                            </select>
                        </div>
                        <table class="variants-table">
                            <thead>
                                <tr>
                                    <th>Color</th>
                                    <th>RAM</th>
                                    <th>Storage</th>
                                    <th>Processor</th>
                                    <th>Display</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="variantsTableBody">
                                <% variants.forEach(function(variant) { %>
                                    <tr class="<%= variant.id == currentId ? 'current-variant' : '' %>" data-price="<%= variant.sm_price %>" data-ram="<%= variant.ram %>" data-color="<%= variant.color %>">
                                        <td><%= variant.color || 'Standard' %></td>
                                        <td><%= variant.ram || 'N/A' %></td>
                                        <td><%= variant.rom || 'N/A' %></td>
                                        <td><%= variant.processor || 'Same' %></td>
                                        <td><%= variant.display_size || 'Same' %></td>
                                        <td>$<%= Number(variant.sm_price).toFixed(2) %></td>
                                        <td>
                                            <% if(variant.sm_inventory > 0) { %>
                                                <span class="stock-status in-stock"><%= variant.sm_inventory %></span>
                                            <% } else { %>
                                                <span class="stock-status out-of-stock">Out of Stock</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if(variant.id != currentId) { %>
                                                <a href="/product/<%= variant.id %>" class="select-variant-btn">Select</a>
                                            <% } else { %>
                                                <span class="current-label">Current</span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>
            <% } %>
            
            <div class="product-specs">
                <h2>Technical Specifications</h2>
                <ul>
                    <li><strong>Processor:</strong> <%= product.processor || 'N/A' %></li>
                    <li><strong>Process Node:</strong> <%= product.process_node || 'N/A' %></li>
                    <li><strong>CPU Cores:</strong> <%= product.cpu_cores || 'N/A' %></li>
                    <li><strong>CPU Frequency:</strong> <%= product.cpu_frequency || 'N/A' %></li>
                    <li><strong>GPU:</strong> <%= product.gpu || 'N/A' %></li>
                    <li><strong>Memory Type:</strong> <%= product.memory_type || 'N/A' %></li>
                    <li><strong>RAM:</strong> <%= product.ram || 'N/A' %></li>
                    <li><strong>ROM:</strong> <%= product.rom || 'N/A' %></li>
                    <li><strong>Expandable Memory:</strong> <%= product.expandable_memory || 'N/A' %></li>
                    <li><strong>Dimensions:</strong> <%= product.length_mm || 'N/A' %> x <%= product.width_mm || 'N/A' %> x <%= product.thickness_mm || 'N/A' %> mm</li>
                    <li><strong>Weight:</strong> <%= product.weight_g || 'N/A' %> g</li>
                    <li><strong>Water/Dust Rating:</strong> <%= product.water_and_dust_rating || 'N/A' %></li>
                    <li><strong>Display Size:</strong> <%= product.display_size || 'N/A' %></li>
                    <li><strong>Resolution:</strong> <%= product.resolution || 'N/A' %></li>
                    <li><strong>Pixel Density:</strong> <%= product.pixel_density || 'N/A' %></li>
                    <li><strong>Refresh Rate:</strong> <%= product.refresh_rate || 'N/A' %></li>
                    <li><strong>Brightness:</strong> <%= product.brightness || 'N/A' %></li>
                    <li><strong>Display Features:</strong> <%= product.display_features || 'N/A' %></li>
                    <li><strong>Main Camera:</strong> <%= product.rear_camera_main || 'N/A' %></li>
                    <li><strong>Macro Camera:</strong> <%= product.rear_camera_macro || 'N/A' %></li>
                    <li><strong>Camera Features:</strong> <%= product.rear_camera_features || 'N/A' %></li>
                    <li><strong>Video Resolution:</strong> <%= product.rear_video_resolution || 'N/A' %></li>
                    <li><strong>Front Camera:</strong> <%= product.front_camera || 'N/A' %></li>
                    <li><strong>Front Camera Features:</strong> <%= product.front_camera_features || 'N/A' %></li>
                    <li><strong>Front Video Resolution:</strong> <%= product.front_video_resolution || 'N/A' %></li>
                    <li><strong>Battery Capacity:</strong> <%= product.battery_capacity || 'N/A' %></li>
                    <li><strong>Fast Charging:</strong> <%= product.fast_charging || 'N/A' %></li>
                    <li><strong>Connector Type:</strong> <%= product.connector || 'N/A' %></li>
                    <li><strong>Security Features:</strong> <%= product.security_features || 'N/A' %></li>
                    <li><strong>SIM Card:</strong> <%= product.sim_card || 'N/A' %></li>
                    <li><strong>NFC:</strong> <%= product.nfc || 'N/A' %></li>
                    <li><strong>Network Bands:</strong> <%= product.network_bands || 'N/A' %></li>
                    <li><strong>Wireless Connectivity:</strong> <%= product.wireless_connectivity || 'N/A' %></li>
                    <li><strong>Navigation:</strong> <%= product.navigation || 'N/A' %></li>
                    <li><strong>Audio Jack:</strong> <%= product.audio_jack || 'N/A' %></li>
                    <li><strong>Audio Playback:</strong> <%= product.audio_playback || 'N/A' %></li>
                    <li><strong>Video Playback:</strong> <%= product.video_playback || 'N/A' %></li>
                    <li><strong>Sensors:</strong> <%= product.sensors || 'N/A' %></li>
                    <li><strong>Operating System:</strong> <%= product.operating_system || 'N/A' %></li>
                    <li><strong>Package Contents:</strong> <%= product.package_contents || 'N/A' %></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            document.getElementById('menu').classList.toggle('hidden');
        }

        // Handle variants sorting
        document.addEventListener('DOMContentLoaded', function() {
            // Handle sorting of variants
            const sortSelect = document.getElementById('sortVariants');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    sortVariants(this.value);
                });
            }

            // Function to sort variants table
            function sortVariants(sortBy) {
                const tableBody = document.getElementById('variantsTableBody');
                if (!tableBody) return;

                const rows = Array.from(tableBody.querySelectorAll('tr'));
                
                rows.sort((a, b) => {
                    switch(sortBy) {
                        case 'color':
                            return a.querySelector('td:nth-child(1)').textContent.localeCompare(
                                b.querySelector('td:nth-child(1)').textContent
                            );
                        case 'price-low':
                            return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
                        case 'price-high':
                            return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
                        case 'ram':
                            return compareSizes(
                                a.querySelector('td:nth-child(2)').textContent,
                                b.querySelector('td:nth-child(2)').textContent
                            );
                        case 'storage':
                            return compareSizes(
                                a.querySelector('td:nth-child(3)').textContent,
                                b.querySelector('td:nth-child(3)').textContent
                            );
                        default:
                            return 0;
                    }
                });

                // Clear and re-append sorted rows
                while (tableBody.firstChild) {
                    tableBody.removeChild(tableBody.firstChild);
                }
                
                rows.forEach(row => tableBody.appendChild(row));
            }

            // Helper function to compare sizes like "8GB", "12GB", etc.
            function compareSizes(a, b) {
                // Extract numeric part
                const numA = parseInt(a.match(/\d+/) || ['0']);
                const numB = parseInt(b.match(/\d+/) || ['0']);
                
                if (numA === numB) {
                    // If numbers are the same, sort by the unit
                    return a.localeCompare(b);
                }
                
                return numA - numB;
            }
        });
    </script>
</body>
</html>
